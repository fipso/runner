name = "NextJS"
match_dependencies = ["next"]

[build]
image = "node:lts-alpine3.17"
before_script = """
echo "Installing dependencies..."
corepack pnpm install

export NODE_ENV=production 
"""
cmd = "corepack pnpm run build"
after_script = "cp -r ./public ./.next/standalone/public"
artifact = ".next/"

[run]
image = "node:lts-alpine3.17"
before_script = """
# Setup NextJS standalone (+ static files) environment

ln -s /runner/.next/static /runner/.next/standalone/.next/static
cd .next/standalone

export NODE_ENV=production
"""
cmd = "node server.js"
port = "3000/tcp"
