name = "NextJS"
match_dependencies = ["next"]

[build]
image = "node:lts-alpine3.17"
before_script = """
export NODE_ENV=production

echo "Installing dependencies..."
corepack npm install
"""
cmd = "corepack pnpm run build"
artifact = ".next/"

[run]
image = "node:lts-alpine3.17"
before_script = """
# Setup NextJS standalone (+ static files) environment

ln -s /runner/.next/static /runner/.next/standalone/.next/static
ln -s /runner/.next/public /runner/.next/standalone/public
cd .next/standalone

export NODE_ENV=production
"""
cmd = "node server.js"
port = "3000/tcp"
